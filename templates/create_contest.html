{% extends "layout.html" %}

{% block title %}Opprett konkurranse{% endblock %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.sandbox.google.com/css2?family=Material+Symbols+Outlined">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.1/font/bootstrap-icons.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% endblock %}

{% block content %}
<div class="container register-page">
  <div class="row justify-content-center">
    <div class="col-sm-12 col-md-8 col-lg-6">
      <div class="card shadow-lg">
        <div class="card-body">
          <h1>Opprett konkurranse</h1>
          <form method="POST" action="{{ url_for('createcontest') }}">
          {{ form.hidden_tag() }}

  <div class="form-group" id="name">
    {{ form.name.label }}
    {{ form.name(class_="form-control") }}
  </div>

  <div class="form-group" id="theme">
    {{ form.theme.label }}
    {{ form.theme(class_="form-select") }}
  </div>

  <div class="form-group" id="time">
    {{ form.time.label }}
    {{ form.time(class_="form-select") }}
  </div>

  <div class="form-group" id="question_type">
    {{ form.question_type.label }}
    {{ form.question_type(class_="form-select", id="question_type") }}
  </div>

  <div class="form-group" id="level">
    {{ form.level.label }}
    {{ form.level(class_="form-select", id="level") }}
  </div>

  <div id="dynamic-select"></div>


            <div class="form-group" id="number_tries">
    {{ form.number_tries.label }}
    {{ form.number_tries(class_="form-select") }}
  </div>
<br>
            <br>
  <div class="form-group">
    {{ form.submit(class="btn btn-primary") }}
  </div>

</form>

      </div>
    </div>
  </div>
</div>
</div>
<script>
$(function() {
    var questionType = $('#question_type select').val();
    var level = $('#level select').val();
    var theme = $('#theme select').val();
    $.ajax({
        type: 'POST',
        url: '{{ url_for("get_dynamic_data") }}',
        data: { 'question_type': questionType, 'level': level, 'theme': theme,'csrf_token': $('input[name="csrf_token"]').val()},
        success: function(data) {
            var dynamicSelectHtml = '';
            dynamicSelectHtml += '<div class="form-group">';
            dynamicSelectHtml += '<label for="dynamic_select">Select question:</label>';
            dynamicSelectHtml += '<select id="dynamic_select" name="dynamic_select" class="form-select">';
            for (var i = 0; i < data.length; i++) {
                var questionId = data[i][0]; // assume the first item in each sub-array is the question ID
                var question = data[i][1]; // assume the second item in each sub-array is the question string
                dynamicSelectHtml += '<option value="' + questionId + '">' + question + '</option>';
            }
            dynamicSelectHtml += '</select></div>';
            if (data.length > 0) {
                $('#dynamic-select').html(dynamicSelectHtml);
            } else {
                alert('No questions found for the selected criteria.');
            }
        },
        error: function(xhr, status, error) {
            alert('An error occurred while retrieving dynamic data.');
        }
    });

    $('#level, #question_type, #theme').change(function() {
        var questionType = $('#question_type select').val();
        var level = $('#level select').val();
        var theme = $('#theme select').val();
        $.ajax({
            type: 'POST',
            url: '{{ url_for("get_dynamic_data") }}',
            data: { 'question_type': $("#question_type select").val(), 'level': $("#level select").val(), 'theme': $("#theme select").val(), 'csrf_token': $('input[name="csrf_token"]').val()},
            success: function(data) {
                var dynamicSelectHtml = '';
                dynamicSelectHtml += '<div class="form-group">';
                dynamicSelectHtml += '<label for="dynamic_select">Select question:</label>';
                dynamicSelectHtml += '<select id="dynamic_select" name="dynamic_select" class="form-select">';
                for (var i = 0; i < data.length; i++) {
                    var questionId = data[i][0]; // assume the first item in each sub-array is the question ID
                    var question = data[i][1]; // assume the second item in each sub-array is the question string
                    dynamicSelectHtml += '<option value="' + questionId + '">' + question + '</option>';
                }
                dynamicSelectHtml += '</select></div>';
                if (data.length > 0) {
                    $('#dynamic-select').html(dynamicSelectHtml);
                } else {
                    alert('No questions found for the selected criteria.');
                }
            },
            error: function(xhr, status, error) {
                alert('An error occurred while retrieving dynamic data.');
            }
        });
    });
});
</script>

{% endblock %}


